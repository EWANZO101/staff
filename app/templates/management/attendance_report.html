{% extends "base.html" %}

{% block title %}Attendance Report - Staff Scheduler{% endblock %}

{% block content %}
<div class="mb-6">
    <div class="flex items-center space-x-2 text-sm text-gray-400 mb-2">
        <a href="{{ url_for('management.reports') }}" class="hover:text-white">Reports</a>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
        <span class="text-gray-300">Attendance Report</span>
    </div>
    <h1 class="text-2xl font-bold text-white">Attendance Report</h1>
    <p class="text-gray-400 mt-1">Scheduled days and leave taken for {{ month_name }} {{ year }}</p>
</div>

<!-- Month/Year Selection -->
<div class="flex items-center justify-between mb-6">
    <div class="flex items-center space-x-4">
        {% set prev_month = month - 1 if month > 1 else 12 %}
        {% set prev_year = year if month > 1 else year - 1 %}
        {% set next_month = month + 1 if month < 12 else 1 %}
        {% set next_year = year if month < 12 else year + 1 %}
        
        <a href="{{ url_for('management.attendance_report', year=prev_year, month=prev_month) }}" 
           class="p-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors">
            <svg class="w-5 h-5 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
        </a>
        <span class="text-xl font-semibold text-white">{{ month_name }} {{ year }}</span>
        <a href="{{ url_for('management.attendance_report', year=next_year, month=next_month) }}" 
           class="p-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors">
            <svg class="w-5 h-5 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
        </a>
    </div>
    
    {% if requirement %}
    <div class="bg-gray-800 rounded-lg border border-gray-700 px-4 py-2">
        <span class="text-gray-400 text-sm">Monthly Requirement:</span>
        <span class="text-white font-medium ml-2">
            {{ requirement.required_days or '-' }} days / {{ requirement.required_hours or '-' }} hours
        </span>
    </div>
    {% endif %}
</div>

<!-- Report Table -->
<div class="bg-gray-800 rounded-lg border border-gray-700 overflow-hidden">
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead class="bg-gray-900 border-b border-gray-700">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Employee</th>
                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-400 uppercase tracking-wider">Scheduled Days</th>
                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-400 uppercase tracking-wider">Leave Days</th>
                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-400 uppercase tracking-wider">Total Working</th>
                    {% if requirement and requirement.required_days %}
                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-400 uppercase tracking-wider">vs Requirement</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-700">
                {% for data in report_data %}
                <tr class="hover:bg-gray-750">
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <div class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center text-white font-medium">
                                {{ data.user.first_name[0] }}{{ data.user.last_name[0] }}
                            </div>
                            <div class="ml-3">
                                <p class="text-white font-medium">{{ data.user.first_name }} {{ data.user.last_name }}</p>
                                <p class="text-gray-500 text-sm">{{ data.user.email }}</p>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-center">
                        <span class="text-blue-400 font-medium">{{ data.scheduled_days }}</span>
                    </td>
                    <td class="px-6 py-4 text-center">
                        <span class="text-yellow-400 font-medium">{{ data.leave_days }}</span>
                    </td>
                    <td class="px-6 py-4 text-center">
                        <span class="text-white font-medium">{{ data.scheduled_days - data.leave_days }}</span>
                    </td>
                    {% if requirement and requirement.required_days %}
                    <td class="px-6 py-4 text-center">
                        {% set diff = data.scheduled_days - data.leave_days - requirement.required_days %}
                        {% if diff >= 0 %}
                        <span class="text-green-400 font-medium">+{{ diff }}</span>
                        {% else %}
                        <span class="text-red-400 font-medium">{{ diff }}</span>
                        {% endif %}
                    </td>
                    {% endif %}
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" class="px-6 py-12 text-center text-gray-500">
                        No active employees found
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Summary -->
{% if report_data %}
<div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
    <div class="bg-gray-800 rounded-lg border border-gray-700 p-4">
        <p class="text-gray-400 text-sm">Total Scheduled Days</p>
        <p class="text-2xl font-bold text-blue-400 mt-1">
            {{ report_data|sum(attribute='scheduled_days') }}
        </p>
    </div>
    <div class="bg-gray-800 rounded-lg border border-gray-700 p-4">
        <p class="text-gray-400 text-sm">Total Leave Days</p>
        <p class="text-2xl font-bold text-yellow-400 mt-1">
            {{ report_data|sum(attribute='leave_days') }}
        </p>
    </div>
    <div class="bg-gray-800 rounded-lg border border-gray-700 p-4">
        <p class="text-gray-400 text-sm">Average per Employee</p>
        <p class="text-2xl font-bold text-white mt-1">
            {{ ((report_data|sum(attribute='scheduled_days') - report_data|sum(attribute='leave_days')) / report_data|length)|round(1) }} days
        </p>
    </div>
</div>
{% endif %}
{% endblock %}
