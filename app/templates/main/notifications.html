{% extends "base.html" %}

{% block title %}Notifications - Staff Scheduler{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold text-gray-100">Notifications</h1>
            <p class="text-gray-400 mt-1">Stay updated with your schedule and tasks</p>
        </div>
        {% if notifications.items %}
        <form method="POST" action="{{ url_for('main.mark_all_read') }}">
            <button type="submit" class="px-4 py-2 bg-dark-700 hover:bg-dark-600 text-gray-300 rounded-lg transition-colors text-sm">
                Mark All Read
            </button>
        </form>
        {% endif %}
    </div>
    
    <!-- Notifications List -->
    <div class="bg-dark-800 border border-dark-600 rounded-xl divide-y divide-dark-600">
        {% if notifications.items %}
            {% for notif in notifications.items %}
            <div class="p-4 {% if not notif.is_read %}bg-dark-700/50{% endif %} hover:bg-dark-700/30 transition-colors" id="notif-{{ notif.id }}">
                <div class="flex items-start">
                    <div class="flex-shrink-0 mt-1">
                        {% if notif.type == 'shift' %}
                        <span class="flex items-center justify-center w-10 h-10 bg-blue-500/20 rounded-full">
                            <span class="text-xl">üìÖ</span>
                        </span>
                        {% elif notif.type == 'leave' %}
                        <span class="flex items-center justify-center w-10 h-10 bg-green-500/20 rounded-full">
                            <span class="text-xl">‚úÖ</span>
                        </span>
                        {% elif notif.type == 'task' %}
                        <span class="flex items-center justify-center w-10 h-10 bg-purple-500/20 rounded-full">
                            <span class="text-xl">üìã</span>
                        </span>
                        {% elif notif.type == 'warning' %}
                        <span class="flex items-center justify-center w-10 h-10 bg-yellow-500/20 rounded-full">
                            <span class="text-xl">‚ö†Ô∏è</span>
                        </span>
                        {% elif notif.type == 'error' %}
                        <span class="flex items-center justify-center w-10 h-10 bg-red-500/20 rounded-full">
                            <span class="text-xl">‚ùå</span>
                        </span>
                        {% elif notif.type == 'success' %}
                        <span class="flex items-center justify-center w-10 h-10 bg-green-500/20 rounded-full">
                            <span class="text-xl">üéâ</span>
                        </span>
                        {% else %}
                        <span class="flex items-center justify-center w-10 h-10 bg-gray-500/20 rounded-full">
                            <span class="text-xl">üîî</span>
                        </span>
                        {% endif %}
                    </div>
                    <div class="ml-4 flex-1">
                        <div class="flex items-start justify-between">
                            <div>
                                <p class="font-medium {% if not notif.is_read %}text-gray-100{% else %}text-gray-300{% endif %}">
                                    {{ notif.title }}
                                </p>
                                <p class="text-sm text-gray-400 mt-1">{{ notif.message }}</p>
                                <p class="text-xs text-gray-500 mt-2">{{ notif.created_at.strftime('%d/%m/%Y at %H:%M') }}</p>
                            </div>
                            <div class="ml-4 flex items-center space-x-2">
                                {% if not notif.is_read %}
                                <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                {% endif %}
                                {% if not notif.is_read %}
                                <button onclick="markAsRead({{ notif.id }})" class="text-gray-500 hover:text-gray-300 text-sm">
                                    Mark read
                                </button>
                                {% endif %}
                            </div>
                        </div>
                        
                        {% if notif.related_type and notif.related_id %}
                        <div class="mt-3">
                            {% if notif.related_type == 'schedule' %}
                            <a href="{{ url_for('main.schedule') }}" class="text-sm text-blue-400 hover:text-blue-300">View Schedule ‚Üí</a>
                            {% elif notif.related_type == 'leave_request' %}
                            <a href="{{ url_for('main.leave') }}" class="text-sm text-blue-400 hover:text-blue-300">View Leave Requests ‚Üí</a>
                            {% elif notif.related_type == 'task' %}
                            <a href="{{ url_for('tasks.view', id=notif.related_id) }}" class="text-sm text-blue-400 hover:text-blue-300">View Task ‚Üí</a>
                            {% elif notif.related_type == 'board_post' %}
                            <a href="{{ url_for('board.view', id=notif.related_id) }}" class="text-sm text-blue-400 hover:text-blue-300">View Post ‚Üí</a>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
        <div class="p-8 text-center">
            <svg class="w-16 h-16 text-gray-600 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
            </svg>
            <p class="mt-4 text-gray-400">No notifications yet</p>
            <p class="text-sm text-gray-500">You'll be notified about shifts, tasks, and leave updates here</p>
        </div>
        {% endif %}
    </div>
    
    <!-- Pagination -->
    {% if notifications.pages > 1 %}
    <div class="flex justify-center space-x-2">
        {% if notifications.has_prev %}
        <a href="{{ url_for('main.notifications', page=notifications.prev_num) }}" class="px-4 py-2 bg-dark-700 hover:bg-dark-600 text-gray-300 rounded-lg">Previous</a>
        {% endif %}
        
        <span class="px-4 py-2 text-gray-400">Page {{ notifications.page }} of {{ notifications.pages }}</span>
        
        {% if notifications.has_next %}
        <a href="{{ url_for('main.notifications', page=notifications.next_num) }}" class="px-4 py-2 bg-dark-700 hover:bg-dark-600 text-gray-300 rounded-lg">Next</a>
        {% endif %}
    </div>
    {% endif %}
</div>

{% block extra_js %}
<script>
function markAsRead(id) {
    fetch(`/api/notifications/${id}/read`, {
        method: 'POST',
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    }).then(response => {
        if (response.ok) {
            const element = document.getElementById(`notif-${id}`);
            element.classList.remove('bg-dark-700/50');
            element.querySelector('.bg-blue-500')?.remove();
            element.querySelector('button')?.remove();
        }
    });
}
</script>
{% endblock %}
{% endblock %}
